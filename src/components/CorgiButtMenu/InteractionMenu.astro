---
import CorgiButtPixi from './CorgiButtPixi.astro';

const menuItems = [
	{ label: 'About', target: 'about' },
	{ label: 'Works', target: 'works' },
	{ label: 'Skills', target: 'skills' },
	{ label: 'Contact', target: 'contact' },
];
---

<div id="interaction-container">
	{menuItems.map((item) => (
		<div class="menu-item" data-target={item.target}>{item.label}</div>
	))}

	<CorgiButtPixi />
</div>

<style>
	#interaction-container {
		position: relative;
		width: 100%;
		flex-grow: 1;
		display: flex;
		justify-content: center;
		align-items: center;
		padding-top: 20px; /* 上部との間隔を確保 */
	}

	.menu-item {
		position: absolute;
		width: 100px;
		height: 100px;
		border-radius: 50%;
		background-color: white;
		border: 4px solid #FFB7C5;
		display: flex;
		justify-content: center;
		align-items: center;
		font-weight: 800;
		color: #E8995E;
		box-shadow: 0 5px 15px rgba(232, 153, 94, 0.2);
		transition: transform 0.3s;
		user-select: none;
		z-index: 5;
	}
	
	.menu-item.active {
		background-color: #FFB7C5;
		color: white;
		transform: scale(1.1);
	}
</style>

<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script is:inline>
	// --- 設定 ---
	const menuRadius = 180; // メニューの配置半径

	// --- コンテンツデータ ---
	const contents = {
		about: { title: "About Me", text: "コーギーが大好きなWebデザイナーです。<br>ふわふわしたデザインが得意です。" },
		works: { title: "My Works", text: "これまでに作成したWebサイトや<br>イラストのギャラリーです。" },
		skills: { title: "Skills", text: "HTML / CSS / JavaScript / Figma<br>わんちゃんのお世話も得意です。" },
		contact: { title: "Contact", text: "お仕事のご依頼はこちらから！<br>お散歩のお誘いも待ってます。" }
	};

	// --- 初期配置 (メニューを円形に並べる) ---
	const menuItems = document.querySelectorAll('.menu-item');
	const totalItems = menuItems.length;
	
	menuItems.forEach((item, index) => {
		const angle = (index / totalItems) * Math.PI * 2 - (Math.PI / 2); 
		const x = Math.cos(angle) * menuRadius;
		const y = Math.sin(angle) * menuRadius;
		
		gsap.set(item, { x: x, y: y });
	});

	// --- PixiJSコンポーネントからのイベント監視 ---
	let currentHitItem = null;

	window.addEventListener('corgi-drag', (e) => {
		const { x, y } = e.detail;
		checkCollision(x, y);
	});

	window.addEventListener('corgi-drop', () => {
		if (currentHitItem) {
			const targetKey = currentHitItem.getAttribute('data-target');
			updateContent(targetKey);
			gsap.fromTo(currentHitItem, {scale: 1.3}, {scale: 1, duration: 0.3, ease: "back.out"});
		}
	});

	function checkCollision(x, y) {
		currentHitItem = null;
		menuItems.forEach(item => {
			const rect = item.getBoundingClientRect();
			// 点(x, y)が矩形内にあるか判定（少し余裕を持たせる）
			const padding = 10;
			if (x >= rect.left - padding && x <= rect.right + padding &&
				y >= rect.top - padding && y <= rect.bottom + padding) {
				item.classList.add("active");
				currentHitItem = item;
			} else {
				item.classList.remove("active");
			}
		});
	}

	function updateContent(key) {
		const data = contents[key];
		const titleEl = document.getElementById('display-title');
		const textEl = document.getElementById('display-text');

		if (!data || !titleEl || !textEl) return;

		gsap.to([titleEl, textEl], {
			opacity: 0,
			y: -10,
			duration: 0.2,
			onComplete: () => {
				titleEl.innerText = data.title;
				textEl.innerHTML = data.text;
				gsap.to([titleEl, textEl], { opacity: 1, y: 0, duration: 0.3 });
			}
		});
	}
</script>

